<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercicio 7</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>
    h1{
        border-bottom-style:inset ;
    }
    h5{
        font-style: italic;
    }
    pre{
        font-style: italic;
        font-size: 1.1em;
    }
    figure{
        display: inline-block;
        font-size: 0.7em;
        margin: 5px;
    }
    img.poltrona{
        width: 24;
        height: 16px;
    }
    .entre-letras{
        letter-spacing: 0.5em;
    }

</style>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-4">
                <img src="https://th.bing.com/th/id/OIP.yeYLpqxQ3WN0kSWvg2kinwAAAA?w=127&h=147&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1" alt="Jockey Club" class="img-fluid">
            </div>
            <div class="col-sm-8">
                <h1>Jockey Club-Controle de Aposta</h1>
                <form>
                    <div class="row">
                        <div class="col-sm-6">
                            <label for="inCavalo">N°Cavalo:</label>
                            <input type="number" min="1" class="form-control" id="inCavalo" required autofocus>
                        </div>
                        <div class="col-sm-6">
                            <h5 id="outCavalo" class="mt-4"></h5>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label for="inAposta">Aposta R$:</label>
                            <input type="number" class="form-control" min="1" step="0.5" id="inValor" required>
                        </div>
                        <div class="col-sm-6">
                            <input type="submit" class="btn btn-primary mt-4" value="Apostar" id="btApostar">
                            <input type="button" class="btn btn-warning mt-4" value="Resumo" id="btResumo">
                            <input type="button" class="btn btn-success mt-4" value="Ganhador" id="btGanhador">
                            <input type="button" class="btn btn-danger mt-4" value="Novo Páreo" id="btNovo">
                        </div>
                    </div>
                </form>
                <pre class="mt-3"></pre>
            </div>
        </div>
    </div>
    <script>
        const frm = document.querySelector("form");
        const respLinha = document.querySelector("pre");
        const respCavalo = document.querySelector("#outCavalo");
        const cavalos = ["Marujo","Tordilho","Belga",'Twister',"Jade",'Lucky']; 
        const apostas = []; 

        frm.addEventListener("submit",(e)=>{
            e.preventDefault()
            const cavalo = Number(frm.inCavalo.value); 
            const valor = Number(frm.inValor.value);

            apostas.push({cavalo,valor}); 

            let lista = `Apostas Realizadas\n${"-".repeat(25)}\n`;

             const obterCavalo=(num)=>{
                const posicao = num-1
                return cavalos[posicao]
            }

            for(const aposta of apostas){
                lista+=`N°${aposta.cavalo} ${obterCavalo(aposta.cavalo)}`;
                lista+=`-R$: ${aposta.valor.toFixed(2)}\n`; 
            }
            respLinha.innerText = lista; 
            frm.reset()
            frm.inCavalo.focus()
        })

            const validarCavalo = (num)=>{
                return num >=1 && num <= cavalos.length; 
            }

            const contarApostas = (num) =>{
                let contador = 0; 
                for(const aposta of apostas){
                    if(aposta.cavalo==num){
                        contador ++   
                    }
                }
                return contador; 
            }; 

            const totalizarApostas = (num)=>{
                let total = 0; 
                for(const aposta of apostas){
                    if(aposta.cavalo == num){
                        total+=aposta.valor 
                    }
                }
                return total; 
            }

            frm.inCavalo.addEventListener("blur",()=>{
                if(frm.inCavalo.value==""){
                    respCavalo.innerText=""; 
                    return; 
                }
                const numCavalo = Number(frm.inCavalo.value)

                if(!validarCavalo(numCavalo)){
                    alert('N° do Cavalo inválido'); 
                    frm.inCavalo.focus(); 
                    return; 
                }

                

                const nome = obterCavalo(numCavalo);
                const contaNum = contarApostas(numCavalo);
                const total = totalizarApostas(numCavalo);

                respCavalo.innerText = `${nome} (Apostas:${contaNum} - R$:${total.toFixed(2)})`; 
            }); 

             frm.inCavalo.addEventListener('focus',()=>{
                frm.inCavalo.value =""; 
                resp.innerText = ""; 
                }); 

              frm.btResumo.addEventListener("click",()=>{
                const somaApostas = [0,0,0,0,0,0]; 

                for(const aposta of apostas){
                    somaApostas[aposta.cavalo-1] +=aposta.valor; 
                }
                let resposta = `N° Cavalo................ R$ Apostado\n${"-".repeat(35)}\n`;
                cavalos.forEach((cavalo,i)=>{
                    resposta+=`${i+1} ${cavalo.padEnd(20)}`
                    resposta+=`${somaApostas[i].toFixed(2).padStart(11)}\n`;
                })
                respLinha.innerText = resposta 
              })  

              frm.btGanhador.addEventListener("click",()=>{
                const ganhador = Number(prompt("N° Cavalo Ganhador: "))

                if(ganhador==NaN || !validarCavalo(ganhador)) {
                    alert("Cavalo Inválido");              
                }
                return; 

                const total = apostas.reduce((acumulador,aposta)=>acumulador+aposta.valor,0); 

                let resumo = `Resultado Final do Páreo \n ${'-'.repeat(30)}\n`
                resumo+=`N° Total de Apostas: ${apostas.length}`
                resumo+=`Total Geral R$: ${total.toFixed(2)}\n \n`
                resumo+=`Ganhador N° ${ganhador} - ${obterCavalo(ganhador)}\n \n`
                resumo+=`N° de Apostas: ${contarApostas(ganhador)}\n`
                resumo+=`Total Apostado: R$: ${totalizarApostas(ganhador).toFixed(2)}`; 

                respLinha.innerText = resumo; 

                frm.btApostar.disabled = true; 
                frm.btGanhador.disabled = true; 
                frm.btNovo.focus(); 
              })

              frm.btNovo.addEventListener("click",()=>window.location.reload()); 

    </script>
</body>
</html>