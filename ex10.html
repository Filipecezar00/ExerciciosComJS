<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validador de Formulário</title>
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <h1 class="mt-3">Criador de Postagens</h1>
           <div class="card mt-3">
           <div class="card-body">
               <form id="form">
                <div class="mb-3">
                    <label for="titulo" class="form-label">Titulo:</label>
                    <input type="text" class="form-control" id="titulo" required>
                </div>
                <div class="mb-3">
                    <label for="slug" class="form-label">Slug:</label>
                    <input type="text" class="form-control" id="slug" required>
                </div>
                <div class="mb-3">
                    <label for="descricao" class="form-label">Descrição:</label>
                    <input type="text" class="form-control" id="descricao" required>
                </div>
                <div class="mb-3">
                    <label for="conteudo" class="form-label">Contéudo:</label>
                    <input type="text" class="form-control" id="conteudo" required>
                </div>
                 <div class="mb-3">
                    <label for="categoria" class="form-label">Categoria:</label>
                    <input type="text" class="form-control" id="categoria" required>
                 </div>
                 <button class="btn btn-success" id="btn_enviar">Criar Postagem</button>
               </form>
               </div>
            </div>
            <input type="text" id="busca" class="form-control mt-3" placeholder="Buscar por título">
        <div id="resp"></div>
        <div id="postagens" class="mt-4"></div>
   </div>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
   <script>
    //ESTRUTURA DOM
      const btn_enviar = document.getElementById("btn_enviar") 
      const titulo = document.getElementById('titulo')
      const slug = document.getElementById("slug")
      const descricao = document.getElementById("descricao")
      const conteudo = document.getElementById("conteudo")
      const categoria = document.getElementById("categoria")
      const resp = document.getElementById("resp")
      const form = document.getElementById("form")
      const Listapostagens = document.getElementById("postagens")
      const InputBusca = document.getElementById("busca") 

      atualizarTela()

      //Evento do Form
      form.addEventListener("submit",(e)=>{
        e.preventDefault()
        validandoForm()
      })
        
      //FUNÇÃO DE VALIDAÇÃO
        function validandoForm(){
         //ARRAY DE ERROS E ESTRUTURAS CONDICIONAIS DE VALIDAÇÕES 
         let erros = []
         if(titulo.value.length<3){
            erros.push("Titulo possui menos de três caracteres")
         }
         if(slug.value.includes(" ") || slug.value !== slug.value.toLowerCase()){
            erros.push("Slug Possui Espaço ou caracteres Maiusculos")
         }
         if(descricao.value==""){
            erros.push("Descrição Não Pode Estar Vazia")
         }
         if(conteudo.value.length<10){
            erros.push("O contéudo Possui Menos de 10 caracteres")
         }
         if(Number(categoria.value)==0 || categoria.value==""){
            erros.push("O Número da Categoria Não Pode Ser igual a 0")
         }
         if(erros.length>0){
            resp.className = "alert alert-danger"
            resp.innerText = ` O formulário Apresenta as Seguintes Limitações \n ${erros.join("\n")}`
         }else{
            const postagem={
                titulo:titulo.value, 
                slug:slug.value, 
                descricao:descricao.value, 
                conteudo:conteudo.value, 
                categoria:categoria.value 
            }
          
           let postagens = JSON.parse(localStorage.getItem("postagem")) || []
           postagens.push(postagem) 
           localStorage.setItem("postagem",JSON.stringify(postagens)); 

           form.reset() 
           resp.className =""
           resp.innerText=""         
            
           atualizarTela(); 
        }
    }
        function atualizarTela(termoBusca){
        Listapostagens.innerHTML = ""; 
        
        let postagens = JSON.parse(localStorage.getItem("postagem")) || [] 
        
        postagens.forEach((postagem,index)=>{
             Listapostagens.innerHTML+=`
            <div class="card mb-2">
                <div class="card-body">
                    <h5>${postagem.titulo}</h5> 
                    <h6>${postagem.slug}</h6>
                    <small>${postagem.descricao}</small> 
                    <small>${postagem.conteudo}</small> 
                    <small>${postagem.categoria}</small> <br> 
                   <button class="btn btn-danger mt-3" onclick="deletarPostagem(${index})">Excluir Postagem</button> 
                    </div>      
            </div>
           `
        })
    }
      function deletarPostagem(index){
            let postagens = JSON.parse(localStorage.getItem("postagem")) || [] 
            postagens.splice(index,1) 
            localStorage.setItem("postagem",JSON.stringify(postagens)) 
            atualizarTela()
        }   

    InputBusca.addEventListener("input",(e)=>{
      const termoDigitado = e.target.value; 
      atualizarTela(termoDigitado) 
      
    })

   </script>
</body>
</html>