<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercicio 9</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="parte2ex9.html">
  <link rel="stylesheet" href="ex9.html">
</head>
<body>
    <div class="container">
        <h1>Jogo "Descubra a Palavra"</h1>
        <a href="ex9.html" class="btn btn-primary">Cadastrar Palavras</a>
        <a href="parte2ex9.html" class="btn btn-success">Listar Palavras</a>
        <a href="parte3ex9.html" class="btn btn-danger">Iniciar Jogo</a>

        <form>
            <div class="row mt-3 corFundo py-2">
                <div class="col-sm-4">
                    <h2 class="text-end mt-1">
                        <label for="inLetra">Informe uma Letra:</label>
                    </h2>
                </div>
                <div class="col-sm-2">
                    <input type="text" class="form-control mt-1" id="inLetra" maxlength="1" required autofocus>
                </div>
                <div class="col-sm-6">
                    <input type="submit" class="btn btn-primary mt-1" value="Jogar" id="btJogar">
                </div>
                <div class="row">
                    <div class="col-sm-8">
                        <h2 class="mt-2">Palavra:
                            <span id="outPalavra" class="entre-letras text-primary"></span>
                        </h2>
                        <h2>N° Chances:
                            <span id="outChances" class="text-danger">4</span>
                        </h2>
                        <h2>Erros: 
                            <span id="outErros" class="entre-letras text-danger"></span>
                        </h2>
                        <h2 id="outMensagemFinal"></h2>
                    </div>
                    <div class="col-sm-4">
                        <h3 class="mt-2">Situação do Jogador:</h3>
                        <img src="imagens/status4.webp" alt="situação do Jogador" class="img-fluid">
                    </div>
                </div>
                <div class="row corFundo p-3">
                    <div class="col-sm-12">
                        <input type="button" value="Ver Dica" class="btn btn-primary" id="btVerDica">
                        <span id="outDica">*Custo: 1 chance</span>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <script>
        const frm = document.querySelector("form"); 
        const respPalavra = document.querySelector("#outPalavra");
        const respErros = document.querySelector("#outErros"); 
        const respDica = document.querySelector("#outDica"); 
        const respChances = document.querySelector("#outChances");
        const respMensagemFinal = document.querySelector("#outMensagemFinal");
        const imgStatus = document.querySelector("img"); 
       
        // declara variáveis globais
        let palavraSorteada ;
        let dicaSorteada;

        window.addEventListener("load",()=>{
            if(!localStorage.getItem("jogoPalavra")){
                alert("Cadastre Palavras Para Jogar"); 
                frm.inLetra.disabled = true; 
                frm.btJogar.disabled = true; 
                frm.btVerDica.disabled = true; 
                return; 
            }
            const palavras = localStorage.getItem("jogoPalavra").split(';'); 
            const dicas = localStorage.getItem("jogoDica").split(";"); 

            const tam = palavras.length; // Número de palavras Cadastradas 

            // gera um número entre 0 e tam-1 (pois arredonda para baixo)
            const numAleatorio = Math.floor(Math.random()*tam); 

            //obtém Palavra (em letras maiusculas) e dica na posição do n° aleatório gerado
            palavraSorteada = palavras[numAleatorio].toUpperCase(); 
            dicaSorteada = dicas[numAleatorio]; 
            let novaPalavra = ""; 

            for(const letra of palavraSorteada){
                if(letra ==palavraSorteada.charAt(0)){
                    novaPalavra+=palavraSorteada.charAt(0); 
                }else{
                    novaPalavra+= "_"; 
                }
            }
            respPalavra.innerText = novaPalavra; 
        })

            const trocarStatus = (num) =>{
            if(num>0){
            imgStatus.src = `imagens/status${num}.webp`; 
        }
    }

            const concluirJogo = () =>{
            respDica.innerText = "*Clique no botão 'iniciar Jogo' para jogar Novamente"  
            frm.inLetra.disabled = true; 
            frm.btJogar.disabled = true; 
            frm.btVerDica.disabled = true;       
            }
            const verificarFim=()=>{
                const chances = Number(respChances.innerText) // obtém o número de chances

                if(chances==0){
                    respMensagemFinal.className = "display-3 text-danger"; 
                    respMensagemFinal.innerText = `Ah.... é ${palavraSorteada}. Você Perdeu!!`
                    concluirJogo(); 
                }else if(respPalavra.innerText==palavraSorteada){
                    respMensagemFinal.className = "display-3 text-primary"; 
                    respMensagemFinal.innerText = "Parabéns!! Você ganhou"; 
                    trocarStatus(4)
                    concluirJogo()
                } 
            }

          frm.addEventListener("submit",(e)=>{
            e.preventDefault(); 
            const letra = frm.inLetra.value.toUpperCase()

            let erros = respErros.innerText; // Obtém contéudo dos elementos 
            let palavra = respPalavra.innerText; 


            if(erros.includes(letra) || palavra.includes(letra)){
                alert("Você já Apostou essa Letra"); 
                frm.inLetra.focus(); 
                return; 
            }
            // se letra consta em palavraSorteada 
            if(palavraSorteada.includes(letra)){
                let novaPalavra = "";  //Para compor NovaPalavra 
                // for para montar palavra a ser exibida 
                for(let i = 0; i<palavraSorteada.length;i++){ 
                    // se igual a letra apostada, acrescenta esta letra na exibição
                    if(palavraSorteada.charAt(i)==letra){
                        novaPalavra+=letra; 
                    }else{
                        novaPalavra+=palavra.charAt(i); 
                    }
                }
                respPalavra.innerText = novaPalavra; 
            }else{
                respErros.innerText +=letra; 
                const chances = Number(respChances.innerText) - 1 
                respChances.innerText = chances; 
                trocarStatus(chances)
            }
            verificarFim()
            frm.inLetra.value = ""; 
            frm.inLetra.focus(); 
        } )

        
      

       frm.btVerDica.addEventListener("click",()=>{
        if(respErros.innerText.includes("*")){
            alert("Você já solicitou a Dica...");
            frm.inLetra.focus(); 
            return; 
        }
        respDica.innerText = " * " + dicaSorteada; //  exibe Dica 
        respErros.innerText +="*";  

        const chances = Number(respChances.innerText) - 1; 
        respChances.innerText = chances;  

        trocarStatus(chances);  // Troca imagem

        verificarFim(); // verifica se atingiu limite de chances 

        frm.inLetra.focus(); 
       })

    </script>
</body>
</html>