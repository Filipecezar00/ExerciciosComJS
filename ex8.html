<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3">
                <img src="https://www.bing.com/images/search?view=detailV2&ccid=Kn%2bcunlv&id=ABCDEA0B50471E7335880A3B3016F02844BE040A&thid=OIP.Kn-cunlv4gJBxYWIqa-93wAAAA&mediaurl=https%3a%2f%2fd1csarkz8obe9u.cloudfront.net%2fposterpreviews%2facting-theatre-logo-template-design-54dc9b19445b3bfa2f24357f747b4668.jpg%3fts%3d1702409299&cdnurl=https%3a%2f%2fth.bing.com%2fth%2fid%2fR.2a7f9cba796fe20241c58588a9afbddf%3frik%3dCgS%252bRCjwFjA7Cg%26pid%3dImgRaw%26r%3d0&exph=199&expw=199&q=teatro+logo&FORM=IRPRST&ck=EC507C599998F23106508D7C130ADE07&selectedIndex=0&itb=0&qft=+filterui%3aimagesize-small" alt="teatro">
            </div>
            <div class="col-sm-9">
                <h1>Teatro: Show Musical-Reserva de Poltronas</h1>
                <form>
                    <div class="row">
                        <div class="col-sm-2">
                            <p><label for="inPoltrona">N° da Poltrona:</label>
                            <input type="number" class="form-control" id="inPoltrona" min="1" required autofocus>
                            </p>
                        </div>
                        <div class="col-sm-4">
                            <input type="submit" class="btn btn-primary mt-4" value="Reservar">
                            <input type="button" class="btn btn-danger mt-4" value="Confirmar Reserva" id="btConfirmar">
                        </div> 
                        <div class="col-sm-6">
                            Legenda: 
                            <p class="mt-2"><img src="imagens/OIP.webp" alt=""> Disponível
                            <img src="imagens/close.png" alt="" class="ms-3">Reservada
                            <img src="imagens/D_Q_NP_2X_998742-MLB45016396939_022021-R.jpg" alt="">Ocupado                      
                            </p>
                        </div>
                    </div>
                </form>
                <div class="row">
                    <div class="col-sm-12" id="divPalco">
                        <p class="bg-primary text-white text-center">Palco do Teatro</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const frm = document.querySelector("form");
        const dvPalco = document.querySelector("#divPalco");
        const poltronas = 240 
        const reservadas = []

        window.addEventListener('load',()=>{
        // Se houver dados salvos no localstorage, faz um split(";") e 
        // Atribui esses dados ao array, caso ao contrário, o array é inicializado vazio 
         const ocupadas = localStorage.getItem('teatroOcupadas') ? localStorage.getItem("teatroOcupadas").split(';'):[]; 

        for(let i = 1; i<poltronas;i++){
            const figure = document.createElement("figure");
            const imgStatus = document.createElement('img');

            imgStatus.src = ocupadas.includes(i.toString()) ? "imagens/reservado.jpg":"imagens/disponivel.webp"; 
            imgStatus.className= "poltrona" // classe com dimensão da img 
            const figureCap = document.createElement('figcaption'); 
        
            const zeros = i<10 ? "00" : i<100 ? "0": ""; 

            const num = document.createTextNode(`[${zeros}${i}]`);  

            figureCap.appendChild(num) 
            figure.appendChild(imgStatus)
            figure.appendChild(figureCap)
            
            if(i%24==12)figure.style.marginRight="60px"; 

            dvPalco.appendChild(figure)
            if(i%24==0){
            dvPalco.appendChild(document.createElement("br")); 
            } 
        }
    })

    frm.addEventListener("submit",(e)=>{
        e.preventDefault()

        const poltrona = Number(frm.inPoltrona.value) // obtém o contéudo do inPoltrona

        if(poltrona>poltronas){
            alert("Informe um número de poltrona válido"); 
            frm.inPoltrona.focus(); 
            return; 
        }
        const ocupadas = localStorage.getItem('teatroOcupadas')?localStorage.getItem("teatroOcupadas").split(";"):[]; 

        if(ocupadas.includes(poltrona.toString())){
            alert(`Poltrona ${poltrona} já está ocupada`); 
            frm.inPoltrona.value=""; 
            frm.inPoltrona.focus(); 
            return; 
        }
        // Captura imagem da poltrona,filha de divPalco. é -1 pois começa em 0 
        const imgPoltrona = dvPalco.querySelector("img")[poltrona-1]; 

        imgPoltrona.src = "imagens/reservada.jpg";

        reservadas.push(poltrona); 

        frm.inPoltrona.value=""; 
        frm.inPoltrona.focus(); 
    })

    frm.btConfirmar.addEventListener("click",()=>{
        if(reservadas.length==0){
            alert("Não há poltronas reservadas"); 
            frm.inPoltrona.focus(); 
            return; 
        }
        const ocupadas = localStorage.getItem('teatroOcupadas')?localStorage.getItem('teatroOcupadas').split(";"):[]; 

        for(let i=reservadas.length-1;i>=0;i--){
            ocupadas.push(reservadas[i]); 

            // Captura imagem da poltrona,filha de divPalco. é -1 pois começa em 0. 
            const imgPoltrona = dvPalco.querySelectorAll("img")[reservadas[i]-1]; 

            imgPoltrona.src = "imagens/reservada.jpg"; 
            reservadas.pop(); // Remove do vetor a reserva já alterada 
        }
        localStorage.setItem("teatroOcupadas",ocupadas.join(";")); 
    })

    
    </script>
</body>
</html>